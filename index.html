<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring Order - Production Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0f172a',
                        secondary: '#1e293b',
                        accent: '#3b82f6',
                        success: '#059669',
                        warning: '#d97706',
                        danger: '#dc2626',
                        corporate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        }
                    },
                    fontFamily: {
                        'corporate': ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'corporate': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'corporate-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'corporate-xl': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)'
                    }
                }
            }
        }
    </script>
</head>
<body class="font-corporate bg-gradient-to-br from-corporate-50 via-white to-corporate-100 min-h-screen antialiased">
    <!-- Header -->
    <header id="mainHeader" class="bg-white/95 backdrop-blur-md shadow-corporate-xl border-b border-corporate-200/50 sticky top-0 z-50 relative overflow-hidden transition-all duration-300">
        <!-- Background Pattern -->
        <div class="absolute inset-0 bg-gradient-to-r from-corporate-50/30 via-white/50 to-accent/5"></div>
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-accent via-primary to-success"></div>
        
        <!-- Minimized Header -->
        <div id="headerMinimized" class="hidden max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 relative">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-br from-primary via-accent to-secondary text-white p-2 rounded-xl shadow-corporate">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l-1-3m1 3l-1-3m-16.5 0l1 3m-1-3l1 3"></path>
                        </svg>
                    </div>
                    <h1 class="text-lg font-bold bg-gradient-to-r from-primary via-accent to-secondary bg-clip-text text-transparent">
                        Monitoring Order
                    </h1>
                    <div class="flex items-center space-x-1">
                        <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                        <span class="text-xs text-success font-medium"></span>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="text-xs text-corporate-600 font-medium" id="lastUpdateTimeMin">Loading...</div>
                    <button id="expandHeaderBtn" class="bg-accent/10 hover:bg-accent/20 text-accent p-2 rounded-lg transition-all duration-200">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Full Header -->
        <div id="headerFull" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5 sm:py-7 relative">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-6 lg:space-y-0">
                <!-- Left Section: Logo & Title -->
                <div class="flex items-center space-x-5">
                    <div class="relative">
                        <div class="bg-gradient-to-br from-primary via-accent to-secondary text-white p-4 rounded-2xl shadow-corporate-lg transform hover:scale-105 transition-all duration-300">
                            <svg class="w-8 h-8 sm:w-9 sm:h-9" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l-1-3m1 3l-1-3m-16.5 0l1 3m-1-3l1 3"></path>
                            </svg>
                        </div>
                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-success rounded-full border-2 border-white animate-pulse"></div>
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-primary via-accent to-secondary bg-clip-text text-transparent tracking-tight">
                            Monitoring Order
                        </h1>
                        <div class="flex items-center space-x-3 mt-1">
                            <p class="text-sm sm:text-base text-corporate-600 font-semibold">Production & Export Dashboard</p>
                            <div class="hidden sm:flex items-center space-x-1">
                                <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                                <span class="text-xs text-success font-medium">Live</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4 mt-2">
                            <div class="flex items-center space-x-1 text-xs text-corporate-500">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Real-time monitoring</span>
                            </div>
                            <div class="flex items-center space-x-1 text-xs text-corporate-500">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                </svg>
                                <span>Secure connection</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Section: Actions & Status -->
                <div class="flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 lg:space-x-6">
                    <!-- Last Update Status -->
                    <div class="order-2 sm:order-1">
                        <div id="lastUpdate" class="bg-white/80 backdrop-blur-sm border border-corporate-200 rounded-xl px-4 py-3 shadow-corporate">
                            <div class="flex items-center space-x-2">
                                <div class="flex items-center space-x-1">
                                    <div class="w-2 h-2 bg-accent rounded-full animate-pulse"></div>
                                    <span class="text-xs font-semibold text-corporate-700 uppercase tracking-wide">Last Modified</span>
                                </div>
                            </div>
                            <div class="text-sm font-bold text-primary mt-1" id="lastUpdateTime">Loading...</div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="order-1 sm:order-2 flex space-x-3">
                        <button id="refreshBtn" class="group bg-gradient-to-r from-accent to-primary hover:from-primary hover:to-accent text-white px-5 sm:px-7 py-3 sm:py-4 rounded-xl flex items-center justify-center space-x-3 transition-all duration-300 shadow-corporate-lg hover:shadow-corporate-xl font-semibold text-sm sm:text-base transform hover:scale-105">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6 group-hover:rotate-180 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"></path>
                            </svg>
                            <span class="hidden sm:inline">Refresh Data</span>
                            <span class="sm:hidden">Refresh</span>
                        </button>
                        
                        <!-- Minimize Header Button -->
                        <button id="minimizeHeaderBtn" class="bg-white/80 backdrop-blur-sm border border-corporate-200 text-corporate-600 hover:text-primary p-3 sm:p-4 rounded-xl transition-all duration-300 shadow-corporate hover:shadow-corporate-lg transform hover:scale-105">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Cards -->
    <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8">
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8">
            <div class="bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-corporate-lg p-3 sm:p-4 lg:p-6 border border-corporate-200 hover:shadow-corporate-xl transition-all duration-300 group active:scale-95">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex-1 mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm font-semibold text-corporate-600 uppercase tracking-wide">Total Orders</p>
                        <p id="totalOrders" class="text-xl sm:text-2xl lg:text-3xl xl:text-4xl font-bold text-primary mt-1 sm:mt-2 group-hover:text-accent transition-colors">-</p>
                        <div class="flex items-center mt-1 sm:mt-2">
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-primary rounded-full mr-1.5 sm:mr-2"></div>
                            <span class="text-xs text-corporate-500 font-medium">Active Orders</span>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-primary/10 to-accent/10 p-2 sm:p-3 lg:p-4 rounded-lg sm:rounded-xl group-hover:from-primary/20 group-hover:to-accent/20 transition-all duration-300 self-end sm:self-auto">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-primary group-hover:text-accent transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-corporate-lg p-3 sm:p-4 lg:p-6 border border-corporate-200 hover:shadow-corporate-xl transition-all duration-300 group active:scale-95">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex-1 mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm font-semibold text-corporate-600 uppercase tracking-wide">Remaining</p>
                        <p id="productionOrders" class="text-xl sm:text-2xl lg:text-3xl xl:text-4xl font-bold text-success mt-1 sm:mt-2 group-hover:text-emerald-600 transition-colors">-</p>
                        <div class="flex items-center mt-1 sm:mt-2">
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-success rounded-full mr-1.5 sm:mr-2"></div>
                            <span class="text-xs text-corporate-500 font-medium">Sisa Order</span>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-success/10 to-emerald-500/10 p-2 sm:p-3 lg:p-4 rounded-lg sm:rounded-xl group-hover:from-success/20 group-hover:to-emerald-500/20 transition-all duration-300 self-end sm:self-auto">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-success group-hover:text-emerald-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-corporate-lg p-3 sm:p-4 lg:p-6 border border-corporate-200 hover:shadow-corporate-xl transition-all duration-300 group active:scale-95">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex-1 mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm font-semibold text-corporate-600 uppercase tracking-wide">Export</p>
                        <p id="exportOrders" class="text-xl sm:text-2xl lg:text-3xl xl:text-4xl font-bold text-warning mt-1 sm:mt-2 group-hover:text-amber-600 transition-colors">-</p>
                        <div class="flex items-center mt-1 sm:mt-2">
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-warning rounded-full mr-1.5 sm:mr-2"></div>
                            <span class="text-xs text-corporate-500 font-medium">Export</span>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-warning/10 to-amber-500/10 p-2 sm:p-3 lg:p-4 rounded-lg sm:rounded-xl group-hover:from-warning/20 group-hover:to-amber-500/20 transition-all duration-300 self-end sm:self-auto">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-warning group-hover:text-amber-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-corporate-lg p-3 sm:p-4 lg:p-6 border border-corporate-200 hover:shadow-corporate-xl transition-all duration-300 group active:scale-95">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex-1 mb-2 sm:mb-0">
                        <p class="text-xs sm:text-sm font-semibold text-corporate-600 uppercase tracking-wide">Brands</p>
                        <p id="uniqueBrands" class="text-xl sm:text-2xl lg:text-3xl xl:text-4xl font-bold text-purple-600 mt-1 sm:mt-2 group-hover:text-violet-600 transition-colors">-</p>
                        <div class="flex items-center mt-1 sm:mt-2">
                            <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-purple-600 rounded-full mr-1.5 sm:mr-2"></div>
                            <span class="text-xs text-corporate-500 font-medium">Active Brands</span>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-600/10 to-violet-600/10 p-2 sm:p-3 lg:p-4 rounded-lg sm:rounded-xl group-hover:from-purple-600/20 group-hover:to-violet-600/20 transition-all duration-300 self-end sm:self-auto">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-purple-600 group-hover:text-violet-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Dashboard -->
        <div class="grid grid-cols-1 gap-6 mb-8">
            <!-- Top Brands Chart -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-corporate-lg border border-corporate-200 hover:shadow-corporate-xl transition-all duration-300">
                <div class="flex items-center justify-between p-6 cursor-pointer" onclick="toggleSection('topBrands')">
                    <div>
                        <h3 class="text-xl font-bold text-primary">Top Brands by Qty</h3>
                        <p class="text-sm text-corporate-600 mt-1"> </p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="bg-gradient-to-br from-accent/10 to-primary/10 p-3 rounded-xl">
                            <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"></path>
                            </svg>
                        </div>
                        <button class="bg-corporate-100 hover:bg-corporate-200 text-corporate-600 p-2 rounded-lg transition-all duration-200">
                            <svg id="topBrandsToggle" class="w-5 h-5 transform rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="topBrandsContent" class="px-6 pb-6 hidden">
                    <div id="topBrandsChart" class="space-y-4">
                        <!-- Chart will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-corporate-lg border border-corporate-200 hover:shadow-corporate-xl transition-all duration-300 mb-8">
            <div class="flex items-center justify-between p-6 cursor-pointer" onclick="toggleSection('quickActions')">
                <div>
                    <h3 class="text-xl font-bold text-primary">Export pdf</h3>
                    <p class="text-sm text-corporate-600 mt-1"> </p>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-br from-success/10 to-emerald-500/10 p-3 rounded-xl">
                        <svg class="w-6 h-6 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"></path>
                        </svg>
                    </div>
                    <button class="bg-corporate-100 hover:bg-corporate-200 text-corporate-600 p-2 rounded-lg transition-all duration-200">
                        <svg id="quickActionsToggle" class="w-5 h-5 transform rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="quickActionsContent" class="px-6 pb-6 hidden">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <button id="exportToPDF" class="bg-gradient-to-r from-success to-emerald-600 hover:from-emerald-600 hover:to-success text-white px-6 py-4 rounded-xl flex items-center justify-center space-x-3 transition-all duration-200 shadow-corporate hover:shadow-corporate-lg font-semibold group">
                        <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"></path>
                        </svg>
                        <span>Export to PDF</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-corporate-lg border border-corporate-200 hover:shadow-corporate-xl transition-all duration-300 mb-8">
            <div class="flex items-center justify-between p-6 cursor-pointer" onclick="toggleSection('filters')">
                <div>
                    <h3 class="text-xl font-bold text-primary">Filters & Search</h3>
                    <p class="text-sm text-corporate-600 mt-1"> </p>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-br from-accent/10 to-primary/10 p-3 rounded-xl">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z"></path>
                        </svg>
                    </div>
                    <button class="bg-corporate-100 hover:bg-corporate-200 text-corporate-600 p-2 rounded-lg transition-all duration-200">
                        <svg id="filtersToggle" class="w-5 h-5 transform rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="filtersContent" class="px-3 sm:px-6 pb-4 sm:pb-6 hidden">
                <div class="space-y-4">
                    <!-- Search Bar - Full Width on Mobile -->
                    <div>
                        <label class="block text-sm font-semibold text-corporate-700 mb-2">üîç Smart Search</label>
                        <div class="relative">
                            <input type="text" id="searchProduct" placeholder="Search product, ID, brand, PO..." class="w-full px-4 py-3 text-sm border border-corporate-300 rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 bg-white/50 backdrop-blur-sm pl-10 pr-16">
                            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-corporate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                <span class="bg-accent/10 text-accent px-2 py-1 rounded-md text-xs font-medium">Smart</span>
                            </div>
                        </div>
                        <div class="mt-1 text-xs text-corporate-500 hidden sm:block">
                            <span class="inline-flex items-center space-x-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>Searches across product name, ID, brand, and PO number automatically</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Filter Dropdowns - Responsive Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-corporate-700 mb-2"> Brand</label>
                            <select id="filterBrand" class="w-full px-3 sm:px-4 py-3 text-sm border border-corporate-300 rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 bg-white/50 backdrop-blur-sm">
                                <option value="">All Brands</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-corporate-700 mb-2"> Size</label>
                            <select id="filterSize" class="w-full px-3 sm:px-4 py-3 text-sm border border-corporate-300 rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 bg-white/50 backdrop-blur-sm">
                                <option value="">All Sizes</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-corporate-700 mb-2"> PO Status</label>
                            <select id="filterPO" class="w-full px-3 sm:px-4 py-3 text-sm border border-corporate-300 rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-200 bg-white/50 backdrop-blur-sm">
                                <option value="">All PO</option>
                                <option value="with-po">With PO</option>
                                <option value="without-po">Without PO</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Clear Button - Full Width on Mobile -->
                    <div class="flex justify-center sm:justify-end mt-4 sm:mt-6">
                        <button id="clearFilters" class="w-full sm:w-auto bg-gradient-to-r from-corporate-500 to-corporate-600 hover:from-corporate-600 hover:to-corporate-700 text-white px-6 py-3 rounded-xl transition-all duration-200 shadow-corporate hover:shadow-corporate-lg font-semibold flex items-center justify-center space-x-2 active:scale-95">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            <span>Clear All Filters</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-corporate-lg p-12 text-center border border-corporate-200">
            <div class="relative">
                <div class="animate-spin rounded-full h-16 w-16 border-4 border-corporate-200 border-t-accent mx-auto mb-6"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="w-8 h-8 bg-gradient-to-br from-accent to-primary rounded-full animate-pulse"></div>
                </div>
            </div>
            <h3 class="text-xl font-bold text-primary mb-2">Loading Dashboard</h3>
            <p class="text-corporate-600 font-medium">Fetching order data from Google Sheets...</p>
            <div class="flex justify-center mt-4">
                <div class="flex space-x-1">
                    <div class="w-2 h-2 bg-accent rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-accent rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-accent rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-corporate-lg p-12 text-center border border-corporate-200 hidden">
            <div class="bg-gradient-to-br from-danger/10 to-red-500/10 p-6 rounded-2xl w-20 h-20 mx-auto mb-6 flex items-center justify-center">
                <svg class="w-10 h-10 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-primary mb-3">Connection Failed</h3>
            <p class="text-corporate-600 mb-6 max-w-md mx-auto">Unable to connect to your Google Sheets. Please verify your API credentials and spreadsheet permissions.</p>
            <button id="retryBtn" class="bg-gradient-to-r from-accent to-primary hover:from-primary hover:to-accent text-white px-8 py-3 rounded-xl transition-all duration-200 shadow-corporate hover:shadow-corporate-lg font-semibold">
                Try Again
            </button>
        </div>

        <!-- Data Table -->
        <div id="dataTable" class="bg-white/80 backdrop-blur-sm rounded-xl sm:rounded-2xl shadow-corporate-lg overflow-hidden border border-corporate-200 hidden">
            <div class="px-3 sm:px-6 py-4 sm:py-6 border-b border-corporate-200 bg-gradient-to-r from-corporate-50 to-white">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg sm:text-xl font-bold text-primary">üìã Order Details</h3>
                        <p id="resultCount" class="text-xs sm:text-sm text-corporate-600 mt-1 font-medium"></p>
                    </div>
                    <div class="bg-gradient-to-br from-accent/10 to-primary/10 p-2 sm:p-3 rounded-lg sm:rounded-xl">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5m18 1.5a1.125 1.125 0 001.125-1.125M19.5 19.5h-7.5c-.621 0-1.125-.504-1.125-1.125m9.75 0V5.625m0 12.75v-1.5m-9.75-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V5.625c0-.621-.504-1.125-1.125-1.125H9.75z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-corporate-200">
                    <thead class="bg-gradient-to-r from-corporate-50 to-corporate-100">
                        <tr>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider">ID</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider">Produk</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider hidden sm:table-cell">Size</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider hidden lg:table-cell">Packing</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider">Brand</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider hidden md:table-cell">#PO</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider hidden lg:table-cell">Order Produksi</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider hidden lg:table-cell">Export</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider">(+/-)</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider hidden xl:table-cell">Tgl Email</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider hidden xl:table-cell">Shipment</th>
                            <th class="px-2 sm:px-4 py-3 sm:py-4 text-left text-xs font-bold text-corporate-700 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="bg-white/50 backdrop-blur-sm divide-y divide-corporate-200">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Order Detail Modal -->
        <div id="orderDetailModal" class="fixed inset-0 bg-primary/20 backdrop-blur-sm overflow-y-auto h-full w-full z-50 hidden">
            <div class="relative top-2 sm:top-10 mx-auto p-3 sm:p-6 w-full sm:w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 shadow-corporate-xl rounded-t-2xl sm:rounded-2xl bg-white/95 backdrop-blur-sm border border-corporate-200 my-0 sm:my-10 min-h-screen sm:min-h-0">
                <div class="mt-3">
                    <div class="flex items-center justify-between mb-4 sm:mb-6 pb-3 sm:pb-4 border-b border-corporate-200">
                        <div class="flex items-center space-x-2 sm:space-x-3">
                            <div class="bg-gradient-to-br from-accent/10 to-primary/10 p-2 sm:p-3 rounded-lg sm:rounded-xl">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h4.125M8.25 8.25V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.124-.08M15.75 18H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192M15.75 18h-1.5A1.125 1.125 0 0113.125 16.875v-1.5c0-.621.504-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125z"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg sm:text-2xl font-bold text-primary">üìã Order Details</h3>
                                <p class="text-xs sm:text-sm text-corporate-600 mt-1 hidden sm:block">Comprehensive order information and status</p>
                            </div>
                        </div>
                        <button id="closeModal" class="text-corporate-400 hover:text-corporate-600 bg-corporate-100 hover:bg-corporate-200 p-2 rounded-xl transition-all duration-200 active:scale-95">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="orderDetailContent" class="space-y-4 sm:space-y-6">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_KEY = "AIzaSyBhiKDVDH4fle5_EqAIaA05YjpxVMEBYZM";
        const SPREADSHEET_ID = "1s8R-WlC13aIf6aGIaIyVZH0Ci4torGQk81gzIGKCJi4";
        const RANGE = "TOTAL ORDER!A:K"; // Adjust range as needed

        let allData = [];
        let filteredData = [];
        let sheetLastModified = null;

        // DOM Elements
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const dataTable = document.getElementById('dataTable');
        const tableBody = document.getElementById('tableBody');
        const refreshBtn = document.getElementById('refreshBtn');
        const retryBtn = document.getElementById('retryBtn');
        const lastUpdate = document.getElementById('lastUpdate');
        const resultCount = document.getElementById('resultCount');

        // Filter elements
        const searchProduct = document.getElementById('searchProduct');
        const filterBrand = document.getElementById('filterBrand');
        const filterSize = document.getElementById('filterSize');
        const filterPO = document.getElementById('filterPO');
        const clearFilters = document.getElementById('clearFilters');

        // Stats elements
        const totalOrders = document.getElementById('totalOrders');
        const productionOrders = document.getElementById('productionOrders');
        const exportOrders = document.getElementById('exportOrders');
        const uniqueBrands = document.getElementById('uniqueBrands');

        // Analytics elements
        const topBrandsChart = document.getElementById('topBrandsChart');

        // Quick action elements
        const exportToPDF = document.getElementById('exportToPDF');

        // Load data from Google Sheets
        async function loadData() {
            try {
                showLoading();
                
                // Get spreadsheet metadata for last modified time using Drive API
                try {
                    const driveUrl = `https://www.googleapis.com/drive/v3/files/${SPREADSHEET_ID}?key=${API_KEY}&fields=modifiedTime,name`;
                    const driveResponse = await fetch(driveUrl);
                    
                    if (driveResponse.ok) {
                        const driveData = await driveResponse.json();
                        if (driveData.modifiedTime) {
                            sheetLastModified = new Date(driveData.modifiedTime);
                        }
                    }
                } catch (driveError) {
                    console.log('Could not get Drive API data, using current time');
                    sheetLastModified = new Date();
                }
                
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${API_KEY}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.values || data.values.length === 0) {
                    throw new Error('No data found in spreadsheet');
                }

                // Process the data (skip header row)
                const headers = data.values[0];
                allData = data.values.slice(1).map((row, index) => {
                    const obj = {};
                    headers.forEach((header, colIndex) => {
                        obj[header] = row[colIndex] || '';
                    });
                    obj._rowIndex = index + 2; // +2 because we skip header and arrays are 0-indexed
                    return obj;
                });

                filteredData = [...allData];
                populateFilters();
                updateStats();
                renderTable();
                showTable();
                updateLastUpdate();

            } catch (error) {
                console.error('Error loading data:', error);
                showError();
            }
        }

        function showLoading() {
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            dataTable.classList.add('hidden');
        }

        function showError() {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            dataTable.classList.add('hidden');
        }

        function showTable() {
            loadingState.classList.add('hidden');
            errorState.classList.add('hidden');
            dataTable.classList.remove('hidden');
        }

        function populateFilters() {
            // Populate brand filter
            const brands = [...new Set(allData.map(item => item.BRAND).filter(brand => brand))];
            filterBrand.innerHTML = '<option value="">All Brands</option>';
            brands.forEach(brand => {
                filterBrand.innerHTML += `<option value="${brand}">${brand}</option>`;
            });

            // Populate size filter
            const sizes = [...new Set(allData.map(item => item.SIZE).filter(size => size))];
            filterSize.innerHTML = '<option value="">All Sizes</option>';
            sizes.forEach(size => {
                filterSize.innerHTML += `<option value="${size}">${size}</option>`;
            });

            // Update PO filter options based on actual data
            const uniquePOs = [...new Set(allData.map(item => item['#PO']).filter(po => po && po.trim() !== ''))];
            filterPO.innerHTML = '<option value="">All PO</option>';
            filterPO.innerHTML += '<option value="with-po">With PO</option>';
            filterPO.innerHTML += '<option value="without-po">Without PO</option>';
            
            // Add specific PO numbers as filter options
            uniquePOs.forEach(po => {
                filterPO.innerHTML += `<option value="${po}">${po}</option>`;
            });
        }

        function updateStats() {
            // Total Orders = sum of order production values
            const totalOrdersSum = allData.reduce((sum, item) => {
                const value = parseFloat(item['ORDER PRODUKSI']) || 0;
                return sum + value;
            }, 0);
            totalOrders.textContent = totalOrdersSum.toLocaleString();
            
            // Production Orders = sum of (+/-) column
            const productionSum = allData.reduce((sum, item) => {
                const value = parseFloat(item['(+/-)']) || 0;
                return sum + value;
            }, 0);
            productionOrders.textContent = productionSum.toLocaleString();
            
            // Export Orders = sum of export values
            const exportSum = allData.reduce((sum, item) => {
                const value = parseFloat(item.EXPORT) || 0;
                return sum + value;
            }, 0);
            exportOrders.textContent = exportSum.toLocaleString();
            
            const brands = new Set(allData.map(item => item.BRAND).filter(brand => brand));
            uniqueBrands.textContent = brands.size;

            // Update analytics
            updateAnalytics();
        }

        function applyFilters() {
            filteredData = allData.filter(item => {
                const searchTerm = searchProduct.value.toLowerCase();
                const brandFilter = filterBrand.value;
                const sizeFilter = filterSize.value;
                const poFilter = filterPO.value;

                // Smart Search - searches across multiple fields
                if (searchTerm) {
                    const searchFields = [
                        item.PRODUK || '',
                        item['ID PRODUK'] || '',
                        item.BRAND || '',
                        item['#PO'] || '',
                        item.SIZE || '',
                        item.PACKING || ''
                    ];
                    
                    const matchFound = searchFields.some(field => 
                        field.toLowerCase().includes(searchTerm)
                    );
                    
                    if (!matchFound) {
                        return false;
                    }
                }

                // Brand filter
                if (brandFilter && item.BRAND !== brandFilter) {
                    return false;
                }

                // Size filter
                if (sizeFilter && item.SIZE !== sizeFilter) {
                    return false;
                }

                // PO filter
                if (poFilter) {
                    const hasPO = item['#PO'] && item['#PO'].trim() !== '';
                    
                    if (poFilter === 'with-po' && !hasPO) return false;
                    if (poFilter === 'without-po' && hasPO) return false;
                    // Filter by specific PO number
                    if (poFilter !== 'with-po' && poFilter !== 'without-po' && item['#PO'] !== poFilter) return false;
                }

                return true;
            });

            renderTable();
        }

        function renderTable() {
            tableBody.innerHTML = '';
            resultCount.textContent = `Showing ${filteredData.length} of ${allData.length} orders`;

            filteredData.forEach((item, index) => {
                const hasProduction = item['ORDER PRODUKSI'] && item['ORDER PRODUKSI'].trim() !== '';
                const hasExport = item.EXPORT && item.EXPORT.trim() !== '';
                
                let statusBadge = '';
                if (hasProduction && hasExport) {
                    statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Production & Export</span>';
                } else if (hasProduction) {
                    statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Production</span>';
                } else if (hasExport) {
                    statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Export</span>';
                } else {
                    statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">Pending</span>';
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-corporate-50/50 transition-all duration-200 group active:bg-corporate-100/50';
                row.innerHTML = `
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-semibold text-primary">${item['ID PRODUK'] || '-'}</td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 text-xs sm:text-sm text-corporate-900">
                        <div class="max-w-xs truncate font-medium">${item.PRODUK || '-'}</div>
                        <div class="sm:hidden text-xs text-corporate-500 mt-1 space-y-1">
                         
                            
                            
                            ${item['#PO'] ? `<div class="inline-flex items-center px-1.5 py-0.5 rounded-md bg-accent/10 text-accent text-xs font-medium ml-1"> ${item['#PO']}</div>` : ''}
                        </div>
                    </td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600 hidden sm:table-cell">
                        <span class="inline-flex items-center px-2 py-1 rounded-lg bg-corporate-100 text-corporate-700 text-xs font-medium">${item.SIZE || '-'}</span>
                    </td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600 hidden lg:table-cell">${item.PACKING || '-'}</td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600">
                        <span class="inline-flex items-center px-2 py-1 rounded-lg bg-purple-100 text-purple-700 text-xs font-medium">${item.BRAND || '-'}</span>
                    </td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600 hidden md:table-cell">
                        <span class="inline-flex items-center px-2 py-1 rounded-lg bg-accent/10 text-accent text-xs font-medium">${item['#PO'] || '-'}</span>
                    </td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600 hidden lg:table-cell">${item['ORDER PRODUKSI'] || '-'}</td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600 hidden lg:table-cell">${item.EXPORT || '-'}</td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-bold ${parseFloat(item['(+/-)']) > 0 ? 'text-success' : parseFloat(item['(+/-)']) < 0 ? 'text-danger' : 'text-corporate-600'}">${item['(+/-)'] || '-'}</td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600 hidden xl:table-cell">${item['Tgl email (order)'] || '-'}</td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-corporate-600 hidden xl:table-cell">${item.Shipment || '-'}</td>
                    <td class="px-2 sm:px-4 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm">
                        <button onclick="showOrderDetail(${index})" class="bg-gradient-to-r from-accent to-primary hover:from-primary hover:to-accent text-white px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl text-xs font-semibold transition-all duration-200 shadow-corporate hover:shadow-corporate-lg group-hover:scale-105 active:scale-95 w-full sm:w-auto">
                            <span class="sm:hidden">üëÅÔ∏è</span>
                            <span class="hidden sm:inline">View Details</span>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateLastUpdate() {
            const now = sheetLastModified || new Date();
            const lastUpdateElement = document.getElementById('lastUpdateTime');
            const lastUpdateElementMin = document.getElementById('lastUpdateTimeMin');
            if (lastUpdateElement) {
                lastUpdateElement.textContent = now.toLocaleString();
            }
            if (lastUpdateElementMin) {
                lastUpdateElementMin.textContent = now.toLocaleString();
            }
        }

        // Header minimize/expand functions
        function minimizeHeader() {
            document.getElementById('headerFull').classList.add('hidden');
            document.getElementById('headerMinimized').classList.remove('hidden');
        }

        function expandHeader() {
            document.getElementById('headerFull').classList.remove('hidden');
            document.getElementById('headerMinimized').classList.add('hidden');
        }

        // Section toggle function
        function toggleSection(sectionName) {
            const content = document.getElementById(sectionName + 'Content');
            const toggle = document.getElementById(sectionName + 'Toggle');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                toggle.classList.remove('rotate-180');
                toggle.classList.add('rotate-0');
            } else {
                content.classList.add('hidden');
                toggle.classList.remove('rotate-0');
                toggle.classList.add('rotate-180');
            }
        }

        function clearAllFilters() {
            searchProduct.value = '';
            filterBrand.value = '';
            filterSize.value = '';
            filterPO.value = '';
            applyFilters();
        }

        function updateAnalytics() {
            // Top Brands Chart
            const brandVolumes = {};
            allData.forEach(item => {
                const brand = item.BRAND || 'Unknown';
                const volume = parseFloat(item['(+/-)']) || 0;
                brandVolumes[brand] = (brandVolumes[brand] || 0) + volume;
            });

            const sortedBrands = Object.entries(brandVolumes)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const maxVolume = Math.max(...sortedBrands.map(([,volume]) => volume));

            topBrandsChart.innerHTML = sortedBrands.map(([brand, volume], index) => {
                const percentage = (volume / maxVolume) * 100;
                const colors = [
                    'from-accent to-primary',
                    'from-success to-emerald-600',
                    'from-warning to-amber-600',
                    'from-purple-600 to-violet-600',
                    'from-pink-500 to-rose-600'
                ];
                const bgColors = [
                    'bg-accent/10',
                    'bg-success/10',
                    'bg-warning/10',
                    'bg-purple-600/10',
                    'bg-pink-500/10'
                ];
                return `
                    <div class="bg-white/50 backdrop-blur-sm rounded-xl p-4 border border-corporate-200 hover:shadow-corporate transition-all duration-300">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full bg-gradient-to-r ${colors[index % colors.length]}"></div>
                                <span class="text-sm font-semibold text-corporate-900 truncate">${brand}</span>
                            </div>
                            <div class="text-right">
                                <span class="text-lg font-bold text-primary">${volume.toLocaleString()}</span>
                                <div class="text-xs text-corporate-500 font-medium">units</div>
                            </div>
                        </div>
                        <div class="w-full bg-corporate-200 rounded-full h-2 overflow-hidden">
                            <div class="bg-gradient-to-r ${colors[index % colors.length]} h-2 rounded-full transition-all duration-500 ease-out" style="width: ${percentage}%"></div>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-xs text-corporate-500 font-medium">${percentage.toFixed(1)}% of top volume</span>
                            <div class="px-2 py-1 rounded-md ${bgColors[index % bgColors.length]} text-xs font-medium text-corporate-700">
                                Rank #${index + 1}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }



        function exportToPDFFunction() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // landscape orientation for better table fit
            
            // Add title
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('Monitoring Order - Production Dashboard', 20, 20);
            
            // Add generation date
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 30);
            doc.text(`Total Records: ${filteredData.length}`, 20, 35);
            
            // Define all columns from the sheet
            const columns = [
                { header: 'ID Produk', dataKey: 'ID PRODUK' },
                { header: 'Produk', dataKey: 'PRODUK' },
                { header: 'Size', dataKey: 'SIZE' },
                { header: 'Packing', dataKey: 'PACKING' },
                { header: 'Brand', dataKey: 'BRAND' },
                { header: '#PO', dataKey: '#PO' },
                { header: 'Order Produksi', dataKey: 'ORDER PRODUKSI' },
                { header: 'Export', dataKey: 'EXPORT' },
                { header: '(+/-)', dataKey: '(+/-)' },
                { header: 'Tgl Email (Order)', dataKey: 'Tgl email (order)' },
                { header: 'Shipment', dataKey: 'Shipment' }
            ];
            
            // Prepare data for the table
            const tableData = filteredData.map(row => {
                const rowData = {};
                columns.forEach(col => {
                    rowData[col.dataKey] = row[col.dataKey] || '-';
                });
                return rowData;
            });
            
            // Generate the table
            doc.autoTable({
                startY: 45,
                head: [columns.map(col => col.header)],
                body: tableData.map(row => columns.map(col => row[col.dataKey])),
                styles: {
                    fontSize: 8,
                    cellPadding: 2,
                    overflow: 'linebreak',
                    halign: 'left'
                },
                headStyles: {
                    fillColor: [30, 64, 175], // primary color
                    textColor: 255,
                    fontStyle: 'bold',
                    fontSize: 9
                },
                alternateRowStyles: {
                    fillColor: [248, 250, 252] // light gray
                },
                columnStyles: {
                    0: { cellWidth: 20 }, // ID Produk
                    1: { cellWidth: 35 }, // Produk
                    2: { cellWidth: 15 }, // Size
                    3: { cellWidth: 20 }, // Packing
                    4: { cellWidth: 20 }, // Brand
                    5: { cellWidth: 20 }, // #PO
                    6: { cellWidth: 25 }, // Order Produksi
                    7: { cellWidth: 20 }, // Export
                    8: { cellWidth: 15 }, // (+/-)
                    9: { cellWidth: 25 }, // Tgl Email
                    10: { cellWidth: 20 } // Shipment
                },
                margin: { left: 10, right: 10 },
                tableWidth: 'auto',
                showHead: 'everyPage'
            });
            
            // Add footer with page numbers
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10);
            }
            
            // Save the PDF
            const fileName = `order_data_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }



        // Order Detail Functions
        function showOrderDetail(index) {
            const order = filteredData[index];
            const modal = document.getElementById('orderDetailModal');
            const content = document.getElementById('orderDetailContent');
            
            // Calculate status
            const hasProduction = order['ORDER PRODUKSI'] && order['ORDER PRODUKSI'].trim() !== '';
            const hasExport = order.EXPORT && order.EXPORT.trim() !== '';
            
            let statusInfo = '';
            if (hasProduction && hasExport) {
                statusInfo = '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">‚úÖ Production & Export Complete</span>';
            } else if (hasProduction) {
                statusInfo = '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">üè≠ Production Complete</span>';
            } else if (hasExport) {
                statusInfo = '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">üì¶ Export Only</span>';
            } else {
                statusInfo = '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">‚è≥ Pending</span>';
            }
            
            content.innerHTML = `
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-3 sm:p-4 rounded-lg mb-3 sm:mb-4">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2 space-y-2 sm:space-y-0">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-900 truncate">${order.PRODUK || 'Unknown Product'}</h4>
                        ${statusInfo}
                    </div>
                    <p class="text-xs sm:text-sm text-gray-600">ID: ${order['ID PRODUK'] || 'N/A'} ‚Ä¢ Brand: ${order.BRAND || 'N/A'}</p>
                </div>
                
                <div class="grid grid-cols-1 gap-4 sm:gap-6">
                    <div class="space-y-3">
                        <h5 class="font-semibold text-gray-900 border-b pb-2 text-sm sm:text-base">üìã Product Information</h5>
                        <div class="space-y-2 text-xs sm:text-sm">
                            <div class="flex justify-between items-start">
                                <span class="text-gray-600 min-w-0 flex-shrink-0 mr-2">Product Name:</span>
                                <span class="font-medium text-right break-words">${order.PRODUK || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Product ID:</span>
                                <span class="font-medium">${order['ID PRODUK'] || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Size:</span>
                                <span class="font-medium">${order.SIZE || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Packing:</span>
                                <span class="font-medium">${order.PACKING || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Brand:</span>
                                <span class="font-medium">${order.BRAND || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Quantity (+/-):</span>
                                <span class="font-medium text-base sm:text-lg ${parseFloat(order['(+/-)']) > 0 ? 'text-green-600' : 'text-red-600'}">${order['(+/-)'] || '-'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h5 class="font-semibold text-gray-900 border-b pb-2 text-sm sm:text-base">üìä Order Status</h5>
                        <div class="space-y-2 text-xs sm:text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">PO Number:</span>
                                <span class="font-medium text-blue-600">${order['#PO'] || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Production Order:</span>
                                <span class="font-medium ${hasProduction ? 'text-green-600' : 'text-red-600'}">${order['ORDER PRODUKSI'] || 'Not Started'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Export Status:</span>
                                <span class="font-medium ${hasExport ? 'text-green-600' : 'text-red-600'}">${order.EXPORT || 'Not Exported'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Email Date:</span>
                                <span class="font-medium">${order['Tgl email (order)'] || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Shipment:</span>
                                <span class="font-medium">${order.Shipment || '-'}</span>
                            </div>
                        </div>
                        
                        <div class="mt-3 sm:mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <h6 class="font-semibold text-blue-900 mb-2 text-xs sm:text-sm">üìã Purchase Order Details</h6>
                            <div class="text-xs sm:text-sm text-blue-800">
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-1 sm:space-y-0">
                                    <span>PO Reference:</span>
                                    <span class="font-mono bg-white px-2 py-1 rounded border text-xs break-all">${order['#PO'] || 'No PO Number'}</span>
                                </div>
                                ${order['#PO'] ? `
                                <div class="mt-2 text-xs text-blue-600 space-y-1">
                                    <p>‚úì PO has been assigned to this order</p>
                                    <p class="hidden sm:block">‚Ä¢ Use this reference for all communications</p>
                                    <p class="hidden sm:block">‚Ä¢ Track progress using this PO number</p>
                                </div>
                                ` : `
                                <div class="mt-2 text-xs text-red-600 space-y-1">
                                    <p>‚ö† No PO number assigned yet</p>
                                    <p class="hidden sm:block">‚Ä¢ Contact procurement team for PO assignment</p>
                                </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 sm:mt-6 p-3 sm:p-4 bg-gray-50 rounded-lg">
                    <h5 class="font-semibold text-gray-900 mb-2 text-sm sm:text-base">üìà Progress Summary</h5>
                    <div class="w-full bg-gray-200 rounded-full h-2 sm:h-3">
                        <div class="bg-gradient-to-r from-blue-500 to-green-500 h-2 sm:h-3 rounded-full transition-all duration-300" 
                             style="width: ${hasProduction && hasExport ? '100%' : hasProduction || hasExport ? '50%' : '0%'}">
                        </div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 mt-1">
                        <span>Order</span>
                        <span>Production</span>
                        <span>Export</span>
                        <span>Complete</span>
                    </div>
                </div>
                
                <div class="mt-4 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-2">
                    <button onclick="exportSingleOrderToPDF(${index})" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition-colors active:scale-95 flex items-center justify-center space-x-2">
                        <span>üìÑ</span>
                        <span>Export to PDF</span>
                    </button>
                    <button onclick="closeOrderDetail()" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors active:scale-95">
                        Close
                    </button>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }
        
        function closeOrderDetail() {
            document.getElementById('orderDetailModal').classList.add('hidden');
        }
        
        function exportSingleOrderToPDF(index) {
            const order = filteredData[index];
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('Order Detail Report', 20, 20);
            
            // Add order info
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 35);
            
            // Product information
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Product Information', 20, 55);
            
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            let yPos = 70;
            
            const productInfo = [
                ['Product Name:', order.PRODUK || '-'],
                ['Product ID:', order['ID PRODUK'] || '-'],
                ['Size:', order.SIZE || '-'],
                ['Packing:', order.PACKING || '-'],
                ['Brand:', order.BRAND || '-'],
                ['Quantity (+/-):', order['(+/-)'] || '-']
            ];
            
            productInfo.forEach(([label, value]) => {
                doc.text(label, 20, yPos);
                doc.text(value, 80, yPos);
                yPos += 10;
            });
            
            // Order status
            yPos += 10;
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('Order Status', 20, yPos);
            
            yPos += 15;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            const statusInfo = [
                ['PO Number:', order['#PO'] || '-'],
                ['Production Order:', order['ORDER PRODUKSI'] || 'Not Started'],
                ['Export Status:', order.EXPORT || 'Not Exported'],
                ['Email Date:', order['Tgl email (order)'] || '-'],
                ['Shipment:', order.Shipment || '-']
            ];
            
            statusInfo.forEach(([label, value]) => {
                doc.text(label, 20, yPos);
                doc.text(value, 80, yPos);
                yPos += 10;
            });
            
            // Save the PDF
            const fileName = `order_detail_${order['ID PRODUK'] || 'unknown'}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }



        // Event listeners
        refreshBtn.addEventListener('click', loadData);
        retryBtn.addEventListener('click', loadData);
        clearFilters.addEventListener('click', clearAllFilters);
        document.getElementById('closeModal').addEventListener('click', closeOrderDetail);
        
        // Header minimize/expand listeners
        document.getElementById('minimizeHeaderBtn').addEventListener('click', minimizeHeader);
        document.getElementById('expandHeaderBtn').addEventListener('click', expandHeader);

        // Filter event listeners
        searchProduct.addEventListener('input', applyFilters);
        filterBrand.addEventListener('change', applyFilters);
        filterSize.addEventListener('change', applyFilters);
        filterPO.addEventListener('change', applyFilters);

        // Quick action event listeners
        exportToPDF.addEventListener('click', exportToPDFFunction);

        // Close modal when clicking outside
        document.getElementById('orderDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeOrderDetail();
            }
        });

        // Initial load
        loadData();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983b8752d00c5ff1',t:'MTc1ODY0NjA5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
